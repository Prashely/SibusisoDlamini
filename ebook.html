<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./styles.css" />
    <title>Free Ebook</title>
    <style>
      .loader {
        display: none;
        border: 4px solid #f3f3f3;
        border-radius: 50%;
        border-top: 4px solid #3498db;
        width: 40px;
        height: 40px;
        -webkit-animation: spin 2s linear infinite; /* Safari */
        animation: spin 2s linear infinite;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      @-webkit-keyframes spin {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
        }
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div class="overlay" id="overlay">
      <div class="loader"></div>
    </div>
    <div class="form-container">
      <form id="userForm">
        <label for="Name">Name:</label>
        <input type="text" id="name" name="Name" required />
        <small id="nameError" class="error"></small>
        <br />
        <label for="Email">Email:</label>
        <input type="email" id="email" name="Email" required />
        <small id="emailError" class="error"></small>
        <br />
        <button type="submit" class="button">Download Ebook</button>
      </form>
    </div>
    <script>
      document
        .getElementById("userForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          // Clear previous errors
          document.getElementById("nameError").textContent = "";
          document.getElementById("emailError").textContent = "";

          let valid = true;
          const name = document.getElementById("name").value.trim();
          const email = document.getElementById("email").value.trim();

          // Name validation
          if (!name) {
            document.getElementById("nameError").textContent =
              "Name is required.";
            valid = false;
          } else if (!/^[a-zA-Z\s]+$/.test(name)) {
            document.getElementById("nameError").textContent =
              "Name can only contain letters and spaces.";
            valid = false;
          }

          // Email validation
          if (!email) {
            document.getElementById("emailError").textContent =
              "Email is required.";
            valid = false;
          } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            document.getElementById("emailError").textContent =
              "Invalid email format.";
            valid = false;
          }

          if (valid) {
            // Show loader
            document.getElementById("overlay").style.display = "flex";

            // Prepare data for submission
            const formData = new FormData();
            formData.append("Name", name);
            formData.append("Email", email);

            // AJAX request
            fetch(
              "https://script.google.com/macros/s/AKfycbypLNg7CvrRsBxqwc_uwZXNR6LPUSZ4UMF9IZKTYFWR818X7hgsKhMqsylOjD_hKaDLuA/exec",
              {
                method: "POST",
                body: formData,
              }
            )
              .then((response) => response.json())
              .then((data) => {
                // Hide loader
                document.getElementById("overlay").style.display = "none";

                if (data.result === "success") {
                  // Trigger PDF download
                  const link = document.createElement("a");
                  link.href = "./Ebook/free-ebook.pdf"; // Update with your actual PDF file path
                  link.download = "Introduction Cryptocurrency & Bitcoin.pdf"; // Update with your desired file name
                  document.body.appendChild(link);
                  link.click();
                  document.body.removeChild(link);
                } else {
                  alert(
                    "There was an error submitting the form. Please try again."
                  );
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert(
                  "There was an error submitting the form. Please try again."
                );
                // Hide loader
                document.getElementById("overlay").style.display = "none";
              });
          }
        });
    </script>
  </body>
</html>
